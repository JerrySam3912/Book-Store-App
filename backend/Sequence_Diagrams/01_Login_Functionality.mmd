sequenceDiagram
    participant User
    participant Frontend as Frontend (React)
    participant AuthController as Auth Controller
    participant DB as Database (MySQL)
    
    Note over User,DB: Login Functionality (5.3.6.1)
    
    User->>+Frontend: Enter email and password
    
    Frontend->>Frontend: Validate input fields
    Frontend->>+AuthController: POST /api/auth/login\n{email, password}
    
    Note over AuthController,DB: Validate User Credentials
    
    AuthController->>+DB: SELECT id, username, email, name,\npassword_hash, role, is_active\nWHERE email = ?
    DB-->>-DB: User data or empty
    
    alt User not found
        DB-->>AuthController: Empty result
        AuthController->>AuthController: Check rows.length === 0
        AuthController-->>Frontend: 401 {message: "Invalid email or password"}
        Frontend-->>User: Display error message
    else User found
        DB-->>AuthController: User data
        AuthController->>AuthController: Check is_active status
        
        alt Account is banned (is_active = 0)
            AuthController-->>Frontend: 403 {message: "Account has been banned"}
            Frontend-->>User: Display ban message
        else Account is active
            AuthController->>AuthController: bcrypt.compare(password, password_hash)
            
            alt Password incorrect
                AuthController-->>Frontend: 401 {message: "Invalid email or password"}
                Frontend-->>User: Display error message
            else Password correct
                Note over AuthController: Generate JWT Token
                AuthController->>AuthController: Create payload:\n{id, username, email, name, role}
                AuthController->>AuthController: jwt.sign(payload, JWT_SECRET,\nexpiresIn: JWT_EXPIRY)
                
                AuthController-->>Frontend: 200 {message: "Login successful",\ntoken: JWT_TOKEN,\nuser: {id, username, email, name, role}}
                
                Note over Frontend: Store Token and Update UI
                Frontend->>Frontend: Store token in localStorage\nor AuthContext
                Frontend->>Frontend: Update user state in Redux
                Frontend-->>User: Redirect to home page\nDisplay success message
            end
        end
    end
    
    AuthController-->>-Frontend: Response completed
    Frontend-->>-User: Process completed
