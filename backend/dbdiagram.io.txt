// Book Store Database Schema for dbdiagram.io
// Copy and paste this code into https://dbdiagram.io/home

Table users {
  id int [pk, increment]
  username varchar(255) [not null, unique]
  email varchar(255) [not null, unique]
  password_hash varchar(255) [not null]
  name varchar(255)
  phone varchar(20)
  role varchar(10) [not null, default: 'USER'] // ENUM('USER','ADMIN')
  is_active boolean [not null, default: true]
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]
}

Table user_addresses {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  full_name varchar(255) [not null]
  phone varchar(20) [not null]
  line1 varchar(255) [not null]
  city varchar(100) [not null]
  state varchar(100)
  country varchar(100) [not null]
  zipcode varchar(20)
  is_default boolean [not null, default: false]
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]
}

Table categories {
  id int [pk, increment]
  name varchar(100) [not null]
  slug varchar(100) [not null, unique]
  parent_id int [ref: > categories.id]
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]
}

Table books {
  id int [pk, increment]
  title varchar(255) [not null]
  description text
  category varchar(100) [not null]
  category_id int [ref: > categories.id]
  author varchar(255)
  publisher varchar(255)
  isbn varchar(50)
  trending boolean [not null, default: false]
  cover_image varchar(255)
  old_price decimal(10,2) [default: 0.00]
  new_price decimal(10,2) [not null]
  stock int [not null, default: 0]
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]
}

Table book_images {
  id int [pk, increment]
  book_id int [not null, ref: > books.id]
  image_url varchar(255) [not null]
  sort_order int [not null, default: 0]
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
}

Table vouchers {
  id int [pk, increment]
  code varchar(50) [not null, unique]
  name varchar(255) [not null]
  description text
  type varchar(20) [not null] // ENUM('PERCENTAGE','FIXED_AMOUNT','FREE_SHIP')
  value decimal(10,2) [not null]
  min_order_amount decimal(10,2) [default: 0.00]
  max_discount decimal(10,2)
  usage_limit int
  used_count int [not null, default: 0]
  valid_from timestamp [not null]
  valid_to timestamp [not null]
  is_active boolean [not null, default: true]
  applicable_categories text
  min_quantity int
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]
}

Table orders {
  id int [pk, increment]
  user_id int [ref: > users.id]
  address_id int [ref: > user_addresses.id]
  name varchar(255) [not null]
  email varchar(255) [not null]
  phone varchar(20) [not null]
  city varchar(100) [not null]
  state varchar(100)
  country varchar(100) [not null]
  zipcode varchar(20)
  status varchar(20) [not null, default: 'PENDING'] // ENUM('PENDING','PAID','SHIPPED','COMPLETED','CANCELLED')
  payment_status varchar(20) [not null, default: 'PENDING'] // ENUM('PENDING','PAID','FAILED','REFUNDED')
  payment_method varchar(20) [not null, default: 'COD'] // ENUM('COD','BANK_TRANSFER','VNPAY')
  shipping_method varchar(100)
  items_total decimal(10,2) [default: 0.00]
  shipping_fee decimal(10,2) [default: 0.00]
  discount_total decimal(10,2) [default: 0.00]
  total_price decimal(10,2) [not null]
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]
}

Table order_items {
  id int [pk, increment]
  order_id int [not null, ref: > orders.id]
  book_id int [not null, ref: > books.id]
  quantity int [not null, default: 1]
  price decimal(10,2) [not null]
  total_price decimal(10,2) [not null]
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
}

Table order_vouchers {
  id int [pk, increment]
  order_id int [not null, ref: > orders.id]
  voucher_id int [not null, ref: > vouchers.id]
  discount_amount decimal(10,2) [not null]
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
}

Table payments {
  id int [pk, increment]
  order_id int [not null, ref: > orders.id]
  amount decimal(10,2) [not null]
  method varchar(20) [not null] // ENUM('COD','BANK_TRANSFER','VNPAY')
  status varchar(20) [not null, default: 'PENDING'] // ENUM('PENDING','SUCCESS','FAILED')
  transaction_ref varchar(100)
  paid_at timestamp
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
}

Table reviews {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  book_id int [not null, ref: > books.id]
  rating int [not null] // 1-5
  comment text
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
}

Table wishlists {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  book_id int [not null, ref: > books.id]
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  
  indexes {
    (user_id, book_id) [unique]
  }
}

Table carts {
  id int [pk, increment]
  user_id int [ref: > users.id]
  status varchar(20) [not null, default: 'ACTIVE'] // ENUM('ACTIVE','ORDERED','ABANDONED')
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]
}

Table cart_items {
  id int [pk, increment]
  cart_id int [not null, ref: > carts.id]
  book_id int [not null, ref: > books.id]
  quantity int [not null, default: 1]
  unit_price decimal(10,2) [not null]
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]
  
  indexes {
    (cart_id, book_id) [unique]
  }
}

Table subscriptions {
  id int [pk, increment]
  user_id int [ref: > users.id]
  email varchar(255) [not null, unique]
  name varchar(255)
  is_active boolean [not null, default: true]
  subscribed_at timestamp [default: `CURRENT_TIMESTAMP`]
  unsubscribed_at timestamp
}

